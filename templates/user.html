{% extends "base.html" %}

{% block content %}
<div class="page-content">
    <h1>User Profile: {{ username }}</h1>
    
    {% if user %}
    <div class="user-card">
        <h2>{{ user.full_name or user.username }}</h2>
        <p><strong>Email:</strong> {{ user.email }}</p>
        <p><strong>Status:</strong> {% if user.is_active %}Active{% else %}Inactive{% endif %}</p>
        <p><small>Member since: {{ user.created_at.strftime('%Y-%m-%d') if user.created_at else 'N/A' }}</small></p>
    </div>
    
    {% if posts %}
    <section>
        <h2>Published Posts ({{ posts|length }})</h2>
        <div class="posts-list">
            {% for post in posts %}
            <article class="post-card">
                <h3>{{ post.title }}</h3>
                <p class="post-meta">
                    <small>{{ post.created_at.strftime('%Y-%m-%d') if post.created_at else 'N/A' }}</small>
                </p>
                <div class="post-content">{{ post.content }}</div>
            </article>
            {% endfor %}
        </div>
    </section>
    {% endif %}
    {% else %}
    <div class="user-card">
        <p>This is an example of a dynamic route using path parameters.</p>
        <p>The username <strong>{{ username }}</strong> was extracted from the URL path.</p>
        <p><em>Note: This user doesn't exist in the database. Visit <a href="/api/create-example-data">/api/create-example-data</a> to create example data, then visit <a href="/user/demo_user">/user/demo_user</a></em></p>
    </div>
    {% endif %}

    <section>
        <h2>How Dynamic Routes with Database Work</h2>
        <p>In <code>main.py</code>, the route uses both path parameters and database queries:</p>
        <pre><code>@app.get("/user/{username}", response_class=HTMLResponse)
async def user_profile(request: Request, username: str, db: Session = Depends(get_db)):
    # Query database using ORM
    user = db.query(User).filter(User.username == username).first()
    
    if not user:
        raise HTTPException(status_code=404, detail="User not found")
    
    # Get related data
    posts = db.query(Post).filter(
        Post.author_id == user.id,
        Post.is_published == True
    ).all()
    
    return templates.TemplateResponse("user.html", {
        "request": request,
        "username": username,
        "user": user,
        "posts": posts
    })</code></pre>
        <p>This demonstrates:</p>
        <ul>
            <li>Using <code>Depends(get_db)</code> to inject database session</li>
            <li>Querying with <code>db.query(Model).filter().first()</code></li>
            <li>Querying related data with filters</li>
            <li>Error handling with HTTPException</li>
        </ul>
    </section>
</div>
{% endblock %}

